<div *ngIf="isLoading" class="loading-message">
  Loading vehicle details...
</div>

<div *ngIf="error" class="error-message">
  Error: {{ error }}
</div>

<div *ngIf="!isLoading && vehicle" class="vehicle-detail-container">
  <h1>{{ vehicle.brand }} {{ vehicle.model }}</h1>
  
  <section class="vehicle-info">
    <h2>Vehicle Information</h2>
    <table>
      <tr>
        <td><strong>Registration Number:</strong></td>
        <td>{{ vehicle.registrationNumber }}</td>
      </tr>
      <tr>
        <td><strong>Year:</strong></td>
        <td>{{ vehicle.year }}</td>
      </tr>
      <tr>
        <td><strong>Mileage:</strong></td>
        <td>{{ vehicle.mileage | number }} km</td>
      </tr>
      <tr>
        <td><strong>License Category:</strong></td>
        <td>{{ vehicle.licenseCategory }}</td>
      </tr>
      <tr>
        <td><strong>Status:</strong></td>
        <td [class.available]="vehicle.status === 'AVAILABLE'">{{ vehicle.status }}</td>
      </tr>
    </table>
  </section>

  <section class="maintenance-history">
    <div class="section-header">
      <h2>Maintenance History</h2>
      <button (click)="toggleMaintenanceForm()" class="add-button">+ Add Maintenance</button>
    </div>

    <form *ngIf="showMaintenanceForm" (ngSubmit)="submitMaintenanceForm()" class="add-form">
      <div class="form-group">
        <label for="maintenance-date">Date:</label>
        <input id="maintenance-date" type="date" [(ngModel)]="maintenanceForm.date" name="date" required>
      </div>
      <div class="form-group">
        <label for="maintenance-type">Type:</label>
        <input id="maintenance-type" type="text" [(ngModel)]="maintenanceForm.type" name="type" placeholder="e.g., Oil Change, Tire Rotation" required>
      </div>
      <div class="form-group">
        <label for="maintenance-description">Description:</label>
        <textarea id="maintenance-description" [(ngModel)]="maintenanceForm.description" name="description" placeholder="Additional details"></textarea>
      </div>
      <div class="form-group">
        <label for="maintenance-cost">Cost:</label>
        <input id="maintenance-cost" type="number" [(ngModel)]="maintenanceForm.cost" name="cost" placeholder="0.00" step="0.01">
      </div>
      <div class="form-actions">
        <button type="submit" [disabled]="maintenanceFormSubmitting">{{ isEditingMaintenance ? (maintenanceFormSubmitting ? 'Saving...' : 'Save') : (maintenanceFormSubmitting ? 'Submitting...' : 'Add Maintenance') }}</button>
        <button type="button" (click)="cancelMaintenanceEdit()" class="cancel-button">Cancel</button>
      </div>
    </form>

    <div *ngIf="maintenanceHistory.length > 0">
      <table class="history-table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Type</th>
            <th>Description</th>
            <th>Cost</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let record of maintenanceHistory">
            <td>{{ record.date | date: 'short' }}</td>
            <td>{{ record.type }}</td>
            <td>{{ record.description }}</td>
            <td>{{ record.cost | currency }}</td>
            <td>
              <button type="button" class="action-button" (click)="beginEditMaintenance(record)">Edit</button>
              <button type="button" class="action-button danger-button" (click)="deleteMaintenance(record)">Delete</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div *ngIf="maintenanceHistory.length === 0" class="no-data-message">
      No maintenance records found.
    </div>
  </section>

  <section class="towing-history">
    <div class="section-header">
      <h2>Towing History</h2>
      <button (click)="toggleTowingForm()" class="add-button">+ Add Towing</button>
    </div>

    <form *ngIf="showTowingForm" (ngSubmit)="submitTowingForm()" class="add-form">
      <div class="form-group">
        <label for="towing-date">Date:</label>
        <input id="towing-date" type="date" [(ngModel)]="towingForm.date" name="date" required>
      </div>
      <div class="form-group">
        <label for="towing-location">Location:</label>
        <input id="towing-location" type="text" [(ngModel)]="towingForm.location" name="location" placeholder="Where the vehicle was towed from/to" required>
      </div>
      <div class="form-group">
        <label for="towing-reason">Reason:</label>
        <textarea id="towing-reason" [(ngModel)]="towingForm.reason" name="reason" placeholder="Why the vehicle was towed"></textarea>
      </div>
      <div class="form-group">
        <label for="towing-duration">Duration (minutes):</label>
        <input id="towing-duration" type="number" [(ngModel)]="towingForm.duration" name="duration" placeholder="Duration in minutes">
      </div>
      <div class="form-actions">
        <button type="submit" [disabled]="towingFormSubmitting">{{ isEditingTowing ? (towingFormSubmitting ? 'Saving...' : 'Save') : (towingFormSubmitting ? 'Submitting...' : 'Add Towing') }}</button>
        <button type="button" (click)="cancelTowingEdit()" class="cancel-button">Cancel</button>
      </div>
    </form>

    <div *ngIf="towingHistory.length > 0">
      <table class="history-table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Location</th>
            <th>Reason</th>
            <th>Duration</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let record of towingHistory">
            <td>{{ record.date | date: 'short' }}</td>
            <td>{{ record.location }}</td>
            <td>{{ record.reason }}</td>
            <td>{{ record.duration }} min</td>
            <td>
              <button type="button" class="action-button" (click)="beginEditTowing(record)">Edit</button>
              <button type="button" class="action-button danger-button" (click)="deleteTowing(record)">Delete</button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
    <div *ngIf="towingHistory.length === 0" class="no-data-message">
      No towing records found.
    </div>
  </section>

  <a routerLink="/vehicles" class="back-link">‚Üê Back to Vehicle List</a>
</div>
